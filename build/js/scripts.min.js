"use strict";function removeClass(e,s){return e.classList.remove(s)}function addClass(e,s){return e.classList.add(s)}function insertAfter(e,s){s.parentNode.insertBefore(e,s.nextSibling)}function removeChildren(e){if(e.hasChildNodes())for(;e.firstChild;)e.removeChild(e.firstChild)}function removeNthChild(e,s,t){const r=e.children;if(r.length>s)for(;r.item(t);)e.removeChild(r.item(t))}function createNode(e){return document.createElement(e)}function append(e,s){return e.appendChild(s)}function toggle(e,s,t){e.classList.contains(s)?(e.classList.remove(s),e.classList.add(t)):(e.classList.add(s),e.classList.remove(t))}function makeBillsList(e,s,t){return e.map((function(e){const r=createNode("li");addClass(r,t);const l=createNode("p");addClass(l,"bill__title"),l.innerText=e.title;const n=createNode("p");addClass(n,"bill__subject"),n.innerText=e.subject;const a=createNode("a");addClass(a,"bill__find-out-more"),a.innerText="Learn more about this bill",a.setAttribute("href",e.link),append(s,r),append(r,n),append(r,l),append(r,a)}))}function addBillsClickEvent(e){const s=document.querySelectorAll(e);for(var t=0;t<s.length;t++)s[t].addEventListener("click",(function(e){toggle(e.target.closest(".js-bills-wrapper").querySelector(".bills__list"),"js-hide","js-show")}))}document.addEventListener("DOMContentLoaded",(function(){addBillsClickEvent(".js-toggle");document.querySelector(".js-search-senator").addEventListener("click",initCongressSearch);document.querySelector(".js-reelection-year").addEventListener("click",initReelectionSearch)}));const senateMembersURL="https://api.propublica.org/congress/v1/116/senate/members.json",APIkey="vdrdO2U515LrtFSSE7YrQbIir6SahKj3098eEEiS",apiObject={method:"GET",headers:{"X-API-Key":APIkey}};async function fetchCongressMembersJSON(){const e=await fetch(senateMembersURL,apiObject,!0);if(200!==e.status)return void alert("There was an error");return await e.json()}async function fetchSenatorBillsJSON(e){try{const s=await fetch(e,apiObject,!0);return 200!==s.status?void alert("There was an error"):s.json()}catch(e){console.log(e,"bill search")}}const initCongressSearch=()=>{const e=document.querySelector(".js-input-name").value,s=document.querySelector(".js-results-senator"),t=document.querySelectorAll(".js-result-wrapper"),r=document.querySelector(".js-no-results"),l=document.querySelector(".js-bills-passed"),n=document.querySelector(".js-bills-introduced");let a;0!==e.length?fetchCongressMembersJSON().then((o=>{a=o.results[0].members;let i={noEntry:!0};if(a.forEach((s=>{e.toLowerCase()!==s.last_name.toLowerCase()&&e.toLowerCase()!==s.first_name.toLowerCase()||(i.firstName=s.first_name,i.lastName=s.last_name,i.nextElection=s.next_election,i.state=s.state,i.id=s.id,i.noEntry=!1,i.bills={},i.bills.passed={},i.bills.introduced={})})),i.noEntry)return removeClass(s,"js-hide"),addClass(s,"js-show"),addClass(r,"js-show"),void t.forEach((e=>{e.classList.contains("js-show")&&(removeClass(e,"js-show"),addClass(e,"js-hide"))}));const c=`https://api.propublica.org/congress/v1/members/${i.id}/bills/passed.json`,d=`https://api.propublica.org/congress/v1/members/${i.id}/bills/introduced.json`;let u=fetchSenatorBillsJSON(c),h=fetchSenatorBillsJSON(d);r.classList.contains("js-show")&&removeClass(r,"js-show");const m=document.querySelector(".results__name"),p=document.querySelector(".results__state"),C=document.querySelector(".results__nextElection");m.innerText=`${i.firstName} ${i.lastName}`,p.innerText=i.state,C.innerText=i.nextElection,removeClass(s,"js-hide"),addClass(s,"js-show"),t.forEach((e=>{addClass(e,"js-show"),removeClass(e,"js-hide")})),Promise.all([u,h]).then((e=>{let s=e[0].results[0].bills,t=e[1].results[0].bills;s.forEach(((e,s)=>{let t={title:e.short_title,link:e.govtrack_url,subject:e.primary_subject};i.bills.passed[s]=t})),t.forEach(((e,s)=>{let t={title:e.short_title,link:e.govtrack_url,subject:e.primary_subject};i.bills.introduced[s]=t}));const r=Object.values(i.bills.passed),a=Object.values(i.bills.introduced);if(removeChildren(l),removeChildren(n),!r.length>0){const e=createNode("p");addClass(e,"no-bills"),e.innerText="Currently no bills passed",append(l,e)}if(!a.length>0){const e=createNode("p");addClass(e,"no-bills"),e.innerText="Currently no bills passed",append(n,e)}makeBillsList(r,l,"bills__list--item"),makeBillsList(a,n,"bills__list--item")}))})).catch((e=>{console.log(e,"member info search")})):alert("Please Enter a Value")},initReelectionSearch=()=>{const e=document.querySelector(".js-input-year"),s=e.options[e.selectedIndex].text,t=document.querySelector(".results__reelection .js-no-results"),r=document.querySelector(".results__reelection--grid"),l=document.querySelector(".results__reelection");let n;fetchCongressMembersJSON().then((e=>{if(n=e.results[0].members,!Number(s))return void alert("Please select a value");removeNthChild(l,2,2);let a={};if(a=n.filter((e=>e.next_election===s)),0===a.length)return addClass(l,"js-show"),removeClass(l,"js-hide"),addClass(t,"js-show"),void(r.classList.contains("js-hide")||(addClass(r,"js-hide"),removeClass(r,"js-show-grid")));t.classList.contains("js-show")&&(removeClass(t,"js-show"),addClass(t,"js-hide")),r.classList.contains("js-hide")&&(removeClass(r,"js-hide"),addClass(r,"js-show-grid")),a.forEach(((e,s)=>{let t={fullName:e.first_name+" "+e.last_name,party:e.party,state:e.state};a[s]=t})),a.forEach((e=>{addClass(l,"js-show"),removeClass(l,"js-hide");const s=createNode("div");addClass(s,"results__reelection--grid"),addClass(s,"js-show-grid");const t=createNode("p"),n=createNode("p"),a=createNode("p");return addClass(n,"results__state"),addClass(t,"results__name"),addClass(a,"results__party"),t.innerText=e.fullName,n.innerText=e.state,insertAfter(s,r),append(s,t),append(s,n),append(s,a),"R"===e.party?(a.innerText="Republican",void addClass(a,"republican")):"D"===e.party?(a.innerText="Democrat",void addClass(a,"democrat")):"ID"===e.party?(a.innerText="Independant",void addClass(a,"independant")):void(a.innerText=e.party)}))})).catch((e=>{console.log(e,"re-election")}))};